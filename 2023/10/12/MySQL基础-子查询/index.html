<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="MySQL基础-子查询一、子查询的引入子查询指一个查询语句嵌套在另一个查询语句内部的查询，这个特性从 MySQL4.1 开始引入。 SQL 中子查询的使用大大增强了 SELECT 查询的能力，因为很多时候查询需要从结果集中获取数据，或者需要从同一个表中先计算得出一个数据结果，然后与这个数据结果（可能是某个标量，也可能是某个集合）进行比较。  现有的一些解决方式： 12345678910111213">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL基础-子查询">
<meta property="og:url" content="https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/index.html">
<meta property="og:site_name" content="大军的秘密花园">
<meta property="og:description" content="MySQL基础-子查询一、子查询的引入子查询指一个查询语句嵌套在另一个查询语句内部的查询，这个特性从 MySQL4.1 开始引入。 SQL 中子查询的使用大大增强了 SELECT 查询的能力，因为很多时候查询需要从结果集中获取数据，或者需要从同一个表中先计算得出一个数据结果，然后与这个数据结果（可能是某个标量，也可能是某个集合）进行比较。  现有的一些解决方式： 12345678910111213">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hulingf.github.io/imgs/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/image-20231012161358022.png">
<meta property="og:image" content="https://hulingf.github.io/imgs/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/image-20231012171402820.png">
<meta property="og:image" content="https://hulingf.github.io/imgs/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/image-20231012173916372.png">
<meta property="article:published_time" content="2023-10-12T08:13:56.603Z">
<meta property="article:modified_time" content="2023-10-12T10:20:46.474Z">
<meta property="article:author" content="hulingF">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hulingf.github.io/imgs/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/image-20231012161358022.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>MySQL基础-子查询</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/hulingF">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/10/13/MySQL%E5%9F%BA%E7%A1%80-%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80DDL/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/10/11/MySQL%E5%9F%BA%E7%A1%80-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&text=MySQL基础-子查询"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&title=MySQL基础-子查询"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&is_video=false&description=MySQL基础-子查询"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=MySQL基础-子查询&body=Check out this article: https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&title=MySQL基础-子查询"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&title=MySQL基础-子查询"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&title=MySQL基础-子查询"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&title=MySQL基础-子查询"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&name=MySQL基础-子查询&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&t=MySQL基础-子查询"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.</span> <span class="toc-text">MySQL基础-子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%BC%95%E5%85%A5"><span class="toc-number">1.1.</span> <span class="toc-text">一、子查询的引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">二、子查询的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%8D%95%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.</span> <span class="toc-text">三、单行子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8D%95%E8%A1%8C%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.单行比较操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.代码示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-HAVING%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.HAVING中的子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-CASE%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.4.</span> <span class="toc-text">4.CASE中的子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%9D%9E%E6%B3%95%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.5.</span> <span class="toc-text">5.非法使用子查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%A4%9A%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.</span> <span class="toc-text">四、多行子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%A4%9A%E8%A1%8C%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.多行比较操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">1.4.2.</span> <span class="toc-text">2.代码示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%A9%BA%E5%80%BC%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.3.</span> <span class="toc-text">3.空值问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.</span> <span class="toc-text">五、相关子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.代码示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%9B%B8%E5%85%B3%E6%9B%B4%E6%96%B0"><span class="toc-number">1.5.2.</span> <span class="toc-text">2.相关更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%9B%B8%E5%85%B3%E5%88%A0%E9%99%A4"><span class="toc-number">1.5.3.</span> <span class="toc-text">3.相关删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%80%A7%E8%83%BD%E6%80%9D%E8%80%83"><span class="toc-number">1.6.</span> <span class="toc-text">六、性能思考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E8%AF%BE%E5%90%8E%E7%BB%83%E4%B9%A0"><span class="toc-number">1.7.</span> <span class="toc-text">七、课后练习</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%9F%A5%E8%AF%A2%E5%92%8CZlotkey%E7%9B%B8%E5%90%8C%E9%83%A8%E9%97%A8%E7%9A%84%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%E5%92%8C%E5%B7%A5%E8%B5%84"><span class="toc-number">1.7.0.0.1.</span> <span class="toc-text">1.查询和Zlotkey相同部门的员工姓名和工资</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%9F%A5%E8%AF%A2%E5%B7%A5%E8%B5%84%E6%AF%94%E5%85%AC%E5%8F%B8%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E9%AB%98%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84%E5%91%98%E5%B7%A5%E5%8F%B7%EF%BC%8C%E5%A7%93%E5%90%8D%E5%92%8C%E5%B7%A5%E8%B5%84"><span class="toc-number">1.7.0.0.2.</span> <span class="toc-text">2.查询工资比公司平均工资高的员工的员工号，姓名和工资</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%80%89%E6%8B%A9%E5%B7%A5%E8%B5%84%E5%A4%A7%E4%BA%8E%E6%89%80%E6%9C%89job-id-x3D-%E2%80%98SA-MAN%E2%80%99-%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84%E5%B7%A5%E8%B5%84%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84last-name-job-id-salary"><span class="toc-number">1.7.0.0.3.</span> <span class="toc-text">3.选择工资大于所有job_id &#x3D; ‘SA_MAN’ 的员工的工资的员工的last_name, job_id, salary</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%A7%93%E5%90%8D%E4%B8%AD%E5%8C%85%E5%90%AB%E5%AD%97%E6%AF%8Du%E7%9A%84%E5%91%98%E5%B7%A5%E5%9C%A8%E7%9B%B8%E5%90%8C%E9%83%A8%E9%97%A8%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84%E5%91%98%E5%B7%A5%E5%8F%B7%E5%92%8C%E5%A7%93%E5%90%8D"><span class="toc-number">1.7.0.0.4.</span> <span class="toc-text">4.查询和姓名中包含字母u的员工在相同部门的员工的员工号和姓名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%9F%A5%E8%AF%A2%E5%9C%A8%E9%83%A8%E9%97%A8%E7%9A%84location-id%E4%B8%BA1700%E7%9A%84%E9%83%A8%E9%97%A8%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84%E5%91%98%E5%B7%A5%E5%8F%B7"><span class="toc-number">1.7.0.0.5.</span> <span class="toc-text">5.查询在部门的location_id为1700的部门工作的员工的员工号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E6%9F%A5%E8%AF%A2%E7%AE%A1%E7%90%86%E8%80%85%E6%98%AFKing%E7%9A%84%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%E5%92%8C%E5%B7%A5%E8%B5%84"><span class="toc-number">1.7.0.0.6.</span> <span class="toc-text">6.查询管理者是King的员工姓名和工资</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-%E6%9F%A5%E8%AF%A2%E5%B7%A5%E8%B5%84%E6%9C%80%E4%BD%8E%E7%9A%84%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF-last-name-salary"><span class="toc-number">1.7.0.0.7.</span> <span class="toc-text">7.查询工资最低的员工信息 (last_name, salary)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-%E6%9F%A5%E8%AF%A2%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E6%9C%80%E4%BD%8E%E7%9A%84%E9%83%A8%E9%97%A8%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.0.0.8.</span> <span class="toc-text">8.查询平均工资最低的部门信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-%E6%9F%A5%E8%AF%A2%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E6%9C%80%E4%BD%8E%E7%9A%84%E9%83%A8%E9%97%A8%E4%BF%A1%E6%81%AF%E5%92%8C%E8%AF%A5%E9%83%A8%E9%97%A8%E7%9A%84%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84-%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.7.0.0.9.</span> <span class="toc-text">9.查询平均工资最低的部门信息和该部门的平均工资 (相关子查询)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-%E6%9F%A5%E8%AF%A2%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E6%9C%80%E9%AB%98%E7%9A%84job%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.0.0.10.</span> <span class="toc-text">10.查询平均工资最高的job信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#11-%E6%9F%A5%E8%AF%A2%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E9%AB%98%E4%BA%8E%E5%85%AC%E5%8F%B8%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E7%9A%84%E9%83%A8%E9%97%A8%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">1.7.0.0.11.</span> <span class="toc-text">11.查询平均工资高于公司平均工资的部门有哪些</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#12-%E6%9F%A5%E8%AF%A2%E5%87%BA%E5%85%AC%E5%8F%B8%E4%B8%AD%E6%89%80%E6%9C%89manager%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.0.0.12.</span> <span class="toc-text">12.查询出公司中所有manager的详细信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#13-%E5%90%84%E4%B8%AA%E9%83%A8%E9%97%A8%E4%B8%AD%EF%BC%8C%E6%9C%80%E9%AB%98%E5%B7%A5%E8%B5%84%E4%B8%AD%E6%9C%80%E4%BD%8E%E7%9A%84%E9%82%A3%E4%B8%AA%E9%83%A8%E9%97%A8%E7%9A%84%E6%9C%80%E4%BD%8E%E5%B7%A5%E8%B5%84%E6%98%AF%E5%A4%9A%E5%B0%91"><span class="toc-number">1.7.0.0.13.</span> <span class="toc-text">13.各个部门中，最高工资中最低的那个部门的最低工资是多少</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#14-%E6%9F%A5%E8%AF%A2%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E6%9C%80%E9%AB%98%E7%9A%84%E9%83%A8%E9%97%A8%E7%9A%84manager%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%EF%BC%9Alast-name-department-id-email-salary"><span class="toc-number">1.7.0.0.14.</span> <span class="toc-text">14.查询平均工资最高的部门的manager的详细信息：last_name, department_id, email, salary</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#15-%E6%9F%A5%E8%AF%A2%E9%83%A8%E9%97%A8%E7%9A%84%E9%83%A8%E9%97%A8%E5%8F%B7%EF%BC%8C%E5%85%B6%E4%B8%AD%E4%B8%8D%E5%8C%85%E6%8B%ACjob-id%E6%98%AF%E2%80%9DST-CLERK%E2%80%9D%E7%9A%84%E9%83%A8%E9%97%A8%E5%8F%B7"><span class="toc-number">1.7.0.0.15.</span> <span class="toc-text">15.查询部门的部门号，其中不包括job_id是”ST_CLERK”的部门号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#16-%E9%80%89%E6%8B%A9%E6%89%80%E6%9C%89%E6%B2%A1%E6%9C%89%E7%AE%A1%E7%90%86%E8%80%85%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84last-name"><span class="toc-number">1.7.0.0.16.</span> <span class="toc-text">16.选择所有没有管理者的员工的last_name</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#17-%E6%9F%A5%E8%AF%A2%E5%91%98%E5%B7%A5%E5%8F%B7%E3%80%81%E5%A7%93%E5%90%8D%E3%80%81%E9%9B%87%E7%94%A8%E6%97%B6%E9%97%B4%E3%80%81%E5%B7%A5%E8%B5%84%EF%BC%8C%E5%85%B6%E4%B8%AD%E5%91%98%E5%B7%A5%E7%9A%84%E7%AE%A1%E7%90%86%E8%80%85%E4%B8%BA-%E2%80%98De-Haan%E2%80%99"><span class="toc-number">1.7.0.0.17.</span> <span class="toc-text">17.查询员工号、姓名、雇用时间、工资，其中员工的管理者为 ‘De Haan’</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#18-%E6%9F%A5%E8%AF%A2%E5%90%84%E9%83%A8%E9%97%A8%E4%B8%AD%E5%B7%A5%E8%B5%84%E6%AF%94%E6%9C%AC%E9%83%A8%E9%97%A8%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E9%AB%98%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84%E5%91%98%E5%B7%A5%E5%8F%B7%EF%BC%8C%E5%A7%93%E5%90%8D%E5%92%8C%E5%B7%A5%E8%B5%84%EF%BC%88%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">1.7.0.0.18.</span> <span class="toc-text">18.查询各部门中工资比本部门平均工资高的员工的员工号，姓名和工资（相关子查询）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#19-%E6%9F%A5%E8%AF%A2%E6%AF%8F%E4%B8%AA%E9%83%A8%E9%97%A8%E4%B8%8B%E7%9A%84%E9%83%A8%E9%97%A8%E4%BA%BA%E6%95%B0%E5%A4%A7%E4%BA%8E5%E7%9A%84%E9%83%A8%E9%97%A8%E5%90%8D%E7%A7%B0%EF%BC%88%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">1.7.0.0.19.</span> <span class="toc-text">19.查询每个部门下的部门人数大于5的部门名称（相关子查询）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#20-%E6%9F%A5%E8%AF%A2%E6%AF%8F%E4%B8%AA%E5%9B%BD%E5%AE%B6%E4%B8%8B%E7%9A%84%E9%83%A8%E9%97%A8%E4%B8%AA%E6%95%B0%E5%A4%A7%E4%BA%8E2%E7%9A%84%E5%9B%BD%E5%AE%B6%E7%BC%96%E5%8F%B7%EF%BC%88%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">1.7.0.0.20.</span> <span class="toc-text">20.查询每个国家下的部门个数大于2的国家编号（相关子查询）</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        MySQL基础-子查询
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">hulingF</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-10-12T08:13:56.603Z" class="dt-published" itemprop="datePublished">2023-10-12</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/MySQL/" rel="tag">MySQL</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="MySQL基础-子查询"><a href="#MySQL基础-子查询" class="headerlink" title="MySQL基础-子查询"></a>MySQL基础-子查询</h1><h2 id="一、子查询的引入"><a href="#一、子查询的引入" class="headerlink" title="一、子查询的引入"></a>一、子查询的引入</h2><p><code>子查询</code>指一个查询语句<code>嵌套</code>在另一个查询语句内部的查询，这个特性从 MySQL4.1 开始引入。 SQL 中子查询的使用大大增强了 SELECT 查询的能力，因为很多时候查询需要从结果集中获取数据，或者需要从同一个表中先计算得出一个数据结果，然后与这个数据结果（可能是某个<code>标量</code>，也可能是某个<code>集合</code>）进行比较。</p>
<p><img src="/../../../../../../imgs/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/image-20231012161358022.png" alt="image-20231012161358022"></p>
<p>现有的一些解决方式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#方式一：存在两次Web服务器与数据库服务器的网络访问延迟</span><br><span class="line"><span class="keyword">SELECT</span> salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">11000</span>;</span><br><span class="line"></span><br><span class="line">#方式二：自连接</span><br><span class="line"><span class="keyword">SELECT</span> e2.last_name,e2.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">JOIN</span> employees e2 <span class="keyword">ON</span> e1.last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span> <span class="keyword">AND</span> e1.`salary` <span class="operator">&lt;</span> e2.`salary`</span><br></pre></td></tr></table></figure>

<p>采用<code>子查询</code>的解决方案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#方式二：子查询</span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">                <span class="keyword">SELECT</span> salary</span><br><span class="line">                <span class="keyword">FROM</span> employees</span><br><span class="line">                <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span></span><br><span class="line">                );</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意事项：</p>
<ul>
<li>子查询要包含在括号内</li>
<li>将子查询放在比较条件的右侧，可读写较强</li>
<li>单行操作符对应单行子查询，多行操作符对应多行子查询</li>
</ul>
</blockquote>
<h2 id="二、子查询的分类"><a href="#二、子查询的分类" class="headerlink" title="二、子查询的分类"></a>二、子查询的分类</h2><p>我们按子查询的结果返回一条还是多条记录，将子查询分为<code>单行子查询</code>、<code>多行子查询</code>。我们按子查询是否被执行多次，将子查询划分为<code>相关子查询</code>和<code>不相关子查询</code>。</p>
<p>子查询从数据表中查询了数据结果，如果这个数据结果<code>只执行一次</code>，然后这个数据结果作为主查询的条件进行执行，那么这样的子查询叫做不相关子查询。同样，如果子查询需要<code>执行多次</code>，即采用循环的方式，先从外部查询开始，每次都将主查询的字段传入子查询进行查询，然后再将结果反馈给外部，这种嵌套的执行方式就称为相关子查询。</p>
<h2 id="三、单行子查询"><a href="#三、单行子查询" class="headerlink" title="三、单行子查询"></a>三、单行子查询</h2><h3 id="1-单行比较操作符"><a href="#1-单行比较操作符" class="headerlink" title="1.单行比较操作符"></a>1.单行比较操作符</h3><table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;</td>
<td>equal to</td>
</tr>
<tr>
<td>&gt;</td>
<td>greater than</td>
</tr>
<tr>
<td>&gt;&#x3D;</td>
<td>greater than or equal to</td>
</tr>
<tr>
<td>&lt;</td>
<td>less than</td>
</tr>
<tr>
<td>&lt;&#x3D;</td>
<td>less than or equal to</td>
</tr>
<tr>
<td>&lt;&gt;</td>
<td>not equal to</td>
</tr>
</tbody></table>
<h3 id="2-代码示例"><a href="#2-代码示例" class="headerlink" title="2.代码示例"></a>2.代码示例</h3><p>&#x3D;&#x3D;题目：查询工资大于149号员工工资的员工的信息&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">			    <span class="keyword">SELECT</span> salary</span><br><span class="line">				<span class="keyword">FROM</span> employees</span><br><span class="line">				<span class="keyword">WHERE</span> employee_id<span class="operator">=</span><span class="number">149</span>);</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;题目：返回job_id与141号员工相同，salary比143号员工多的员工姓名、job_id和salary&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">=</span> (</span><br><span class="line">				<span class="keyword">SELECT</span> job_id</span><br><span class="line">				<span class="keyword">FROM</span> employees</span><br><span class="line">    			<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">141</span></span><br><span class="line">				)</span><br><span class="line"><span class="keyword">AND</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">			 <span class="keyword">SELECT</span> salary</span><br><span class="line">			 <span class="keyword">FROM</span> employees</span><br><span class="line">    		 <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">143</span></span><br><span class="line">			 );</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;题目：查询与141号员工的manager_id和department_id相同的其他员工的employee_id， manager_id，department_id&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 实现方式一：不成对比较</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, manager_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> manager_id <span class="operator">=</span> (</span><br><span class="line">                   <span class="keyword">SELECT</span> manager_id</span><br><span class="line">                   <span class="keyword">FROM</span> employees</span><br><span class="line">                   <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">141</span></span><br><span class="line">                   )</span><br><span class="line"><span class="keyword">AND</span> department_id <span class="operator">=</span> (</span><br><span class="line">                    <span class="keyword">SELECT</span> department_id</span><br><span class="line">                    <span class="keyword">FROM</span> employees</span><br><span class="line">                    <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">141</span></span><br><span class="line">                    )</span><br><span class="line"><span class="keyword">AND</span> employee_id <span class="operator">&lt;&gt;</span> <span class="number">141</span>;</span><br><span class="line"></span><br><span class="line"># 实现方式二：成对比较</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, manager_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (manager_id, department_id) <span class="operator">=</span> (</span><br><span class="line">        							<span class="keyword">SELECT</span> manager_id, department_id</span><br><span class="line">        							<span class="keyword">FROM</span> employees</span><br><span class="line">        							<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">141</span></span><br><span class="line">									)</span><br><span class="line"><span class="keyword">AND</span> employee_id <span class="operator">&lt;&gt;</span> <span class="number">141</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-HAVING中的子查询"><a href="#3-HAVING中的子查询" class="headerlink" title="3.HAVING中的子查询"></a>3.HAVING中的子查询</h3><p>&#x3D;&#x3D;题目：查询最低工资大于50号部门最低工资的部门id和其最低工资&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">MIN</span>(salary) <span class="operator">&gt;</span> (</span><br><span class="line">            		 <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line">            		 <span class="keyword">FROM</span> employees</span><br><span class="line">            		 <span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">50</span></span><br><span class="line">					 );</span><br></pre></td></tr></table></figure>

<h3 id="4-CASE中的子查询"><a href="#4-CASE中的子查询" class="headerlink" title="4.CASE中的子查询"></a>4.CASE中的子查询</h3><p>&#x3D;&#x3D;题目：显示员工的employee_id,last_name和location。其中，若员工department_id与location_id为1800的department_id相同，则location为’Canada’，其余则为’USA’。&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, (<span class="keyword">CASE</span> department_id</span><br><span class="line">    							<span class="keyword">WHEN</span> (<span class="keyword">SELECT</span> department_id <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> location_id <span class="operator">=</span> <span class="number">1800</span>)</span><br><span class="line">    							<span class="keyword">THEN</span> <span class="string">&#x27;Canada&#x27;</span> </span><br><span class="line">     							<span class="keyword">ELSE</span> <span class="string">&#x27;USA&#x27;</span> <span class="keyword">END</span>) <span class="keyword">AS</span> &quot;location&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="5-非法使用子查询"><a href="#5-非法使用子查询" class="headerlink" title="5.非法使用子查询"></a>5.非法使用子查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 错误的原因：多行子查询使用单行比较符</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (</span><br><span class="line">    		   <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line">			   <span class="keyword">FROM</span> employees</span><br><span class="line">			   <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">			   );</span><br></pre></td></tr></table></figure>

<h2 id="四、多行子查询"><a href="#四、多行子查询" class="headerlink" title="四、多行子查询"></a>四、多行子查询</h2><h3 id="1-多行比较操作符"><a href="#1-多行比较操作符" class="headerlink" title="1.多行比较操作符"></a>1.多行比较操作符</h3><table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>IN</td>
<td>等于列表中的任意一个</td>
</tr>
<tr>
<td>ANY</td>
<td>需要和单行比较操作符一起使用，和子查询返回的某一个值比较</td>
</tr>
<tr>
<td>ALL</td>
<td>需要和单行比较操作符一起使用，和子查询返回的所有值比较</td>
</tr>
<tr>
<td>SOME</td>
<td>实际上是ANY的别名，作用相同，一般常使用ANY</td>
</tr>
</tbody></table>
<h3 id="2-代码示例-1"><a href="#2-代码示例-1" class="headerlink" title="2.代码示例"></a>2.代码示例</h3><p>&#x3D;&#x3D;题目：返回其它job_id中比job_id为‘IT_PROG’部门任一工资低的员工的员工号、姓名、job_id 以及salary&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">&lt;&gt;</span> <span class="string">&#x27;IT_PROG&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> salary <span class="operator">&lt;</span> <span class="keyword">ANY</span>(</span><br><span class="line">				<span class="keyword">SELECT</span> salary</span><br><span class="line">    			<span class="keyword">FROM</span> employees</span><br><span class="line">    			<span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="string">&#x27;IT_PROG&#x27;</span></span><br><span class="line">				);</span><br><span class="line"># 等价的写法：</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">&lt;&gt;</span> <span class="string">&#x27;IT_PROG&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> salary <span class="operator">&lt;</span> (</span><br><span class="line">			<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary)</span><br><span class="line">			<span class="keyword">FROM</span> employees</span><br><span class="line">			<span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="string">&#x27;IT_PROG&#x27;</span></span><br><span class="line">			);</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;题目：查询平均工资最低的部门id&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#方式<span class="number">1</span>：</span><br><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">=</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(avg_sal)</span><br><span class="line">        <span class="keyword">FROM</span> (</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> &quot;avg_sal&quot;</span><br><span class="line">            <span class="keyword">FROM</span> employees</span><br><span class="line">            <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">            ) t_dept_avg_sal</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#方式<span class="number">2</span>：</span><br><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&lt;=</span> <span class="keyword">ALL</span>(</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> &quot;avg_sal&quot;</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="3-空值问题"><a href="#3-空值问题" class="headerlink" title="3.空值问题"></a>3.空值问题</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 找出所有的管理者：</span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> manager_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 找出所有的非管理者：</span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> manager_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 找出所有的非管理者（错误写法）：</span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> manager_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面的子查询里面内部查询的结果集可能包含NULL，使用IN操作符比较时类似于OR的串联操作，因此包含NULL不影响结果；使用NOT IN操作符类似于AND的串联操作，因此一旦出现NULL则结果必为空集。</p>
</blockquote>
<h2 id="五、相关子查询"><a href="#五、相关子查询" class="headerlink" title="五、相关子查询"></a>五、相关子查询</h2><p>如果子查询的执行依赖于外部查询，通常情况下都是因为子查询中的表用到了外部的表，并进行了条件关联，因此每执行一次外部查询，子查询都要重新计算一次，这样的子查询就称之为<code>关联子查询</code>。</p>
<p>相关子查询按照一行接一行的顺序执行，主查询的每一行都执行一次子查询。</p>
<p><img src="/../../../../../../imgs/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/image-20231012171402820.png" alt="image-20231012171402820"></p>
<h3 id="1-代码示例"><a href="#1-代码示例" class="headerlink" title="1.代码示例"></a>1.代码示例</h3><p>&#x3D;&#x3D;题目：查询员工中工资大于本部门平均工资的员工的last_name,salary和其department_id&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：在<span class="keyword">WHERE</span>中声明子查询</span><br><span class="line"><span class="keyword">SELECT</span> e1.last_name, e1.salary, e1.department</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">WHERE</span> e1.salary <span class="operator">&gt;</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(e2.salary)</span><br><span class="line">    	<span class="keyword">FROM</span> employees e2</span><br><span class="line">    	<span class="keyword">WHERE</span> e2.department_id <span class="operator">=</span> e1.department_id</span><br><span class="line">);</span><br><span class="line"># 方式二：在<span class="keyword">FROM</span>中声明子查询</span><br><span class="line"><span class="keyword">SELECT</span> e.last_name, e.salary, e.department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e, (</span><br><span class="line">    			<span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> &quot;avg_sal&quot;</span><br><span class="line">    			<span class="keyword">FROM</span> employees</span><br><span class="line">    			<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id) t_dept_avg_sal</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> t_dept_avg_sal.department_id</span><br><span class="line"><span class="keyword">AND</span> e.salary <span class="operator">&gt;</span> t_dept_avg_salary.avg_sal;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;题目：查询员工的id,salary,按照department_name排序&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, e.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> d.department_name</span><br><span class="line">    <span class="keyword">FROM</span> departments d</span><br><span class="line">    <span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;题目：若employees表中employee_id与job_history表中employee_id相同的数目不小于2，输出这些相同id的员工的employee_id,last_name和其job_id&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, e.last_name, e.job_id</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">2</span> <span class="operator">&lt;=</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line">        	<span class="keyword">FROM</span> job_history j</span><br><span class="line">        	<span class="keyword">WHERE</span> j.employee_id <span class="operator">=</span> e.employee_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;题目：查询公司管理者的employee_id，last_name，job_id，department_id信息&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：<span class="keyword">EXISTS</span></span><br><span class="line"><span class="keyword">SELECT</span> e1.employee_id, e1.last_name, e1.job_id, e1.department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> ( </span><br><span class="line">    	<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">        <span class="keyword">FROM</span> employees e2</span><br><span class="line">        <span class="keyword">WHERE</span> e2.manager_id <span class="operator">=</span> e1.employee_id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 方式二：自连接</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> e1.employee_id, e1.last_name, e1.job_id, e1.department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1 <span class="keyword">JOIN</span> employees e2</span><br><span class="line"><span class="keyword">ON</span> e1.employee_id <span class="operator">=</span> e2.manager_id;</span><br><span class="line"></span><br><span class="line"># 方式三：<span class="keyword">IN</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, department_id</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager_id</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;题目：查询departments表中，不存在于employees表中的部门的department_id和department_name&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：右连接</span><br><span class="line"><span class="keyword">SELECT</span> d.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span> departments e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"># 方式二：<span class="keyword">NOT</span> <span class="keyword">EXISTS</span></span><br><span class="line"><span class="keyword">SELECT</span> d.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span> employees e</span><br><span class="line">    <span class="keyword">WHERE</span> d.`department_id` <span class="operator">=</span> e.`department_id`</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="2-相关更新"><a href="#2-相关更新" class="headerlink" title="2.相关更新"></a>2.相关更新</h3><p>&#x3D;&#x3D;题目：在employees中增加一个department_name字段，数据为员工对应的部门名称&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1</span>）</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employees</span><br><span class="line"><span class="keyword">ADD</span>(department_name VARCHAR2(<span class="number">14</span>));</span><br><span class="line"></span><br><span class="line"># <span class="number">2</span>）</span><br><span class="line"><span class="keyword">UPDATE</span> employees e</span><br><span class="line"><span class="keyword">SET</span> department_name <span class="operator">=</span> (</span><br><span class="line">    				  <span class="keyword">SELECT</span> department_name</span><br><span class="line">					  <span class="keyword">FROM</span> departments d</span><br><span class="line">					  <span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line">					  );</span><br></pre></td></tr></table></figure>

<h3 id="3-相关删除"><a href="#3-相关删除" class="headerlink" title="3.相关删除"></a>3.相关删除</h3><p>&#x3D;&#x3D;题目：删除表employees中，其与emp_history表皆有的数据&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (</span><br><span class="line">    				 <span class="keyword">SELECT</span> employee_id</span><br><span class="line">    				 <span class="keyword">FROM</span> emp_history</span><br><span class="line">                     <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> e.employee_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="六、性能思考"><a href="#六、性能思考" class="headerlink" title="六、性能思考"></a>六、性能思考</h2><p>&#x3D;&#x3D;问题：谁的工资比Abel的高？&#x3D;&#x3D;</p>
<p> 解答：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#方式<span class="number">1</span>：自连接</span><br><span class="line"><span class="keyword">SELECT</span> e2.last_name,e2.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e1,employees e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> e1.`salary` <span class="operator">&lt;</span> e2.`salary`;</span><br><span class="line"></span><br><span class="line">#方式<span class="number">2</span>：子查询</span><br><span class="line"><span class="keyword">SELECT</span> last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;问题：以上两种方式有好坏之分吗？&#x3D;&#x3D;</p>
<p>解答：自连接方式好！题目中可以使用子查询，也可以使用自连接。一般情况建议使用自连接，因为在许多 DBMS 的处理过程中，对于自连接的处理速度要比子查询快得多。 可以这样理解：子查询实际上是通过未知表进行查询后的条件判断，而自连接是通过已知的自身数据表进行条件判断，因此在大部分 DBMS 中都对自连接处理进行了优化。</p>
<h2 id="七、课后练习"><a href="#七、课后练习" class="headerlink" title="七、课后练习"></a>七、课后练习</h2><h5 id="1-查询和Zlotkey相同部门的员工姓名和工资"><a href="#1-查询和Zlotkey相同部门的员工姓名和工资" class="headerlink" title="1.查询和Zlotkey相同部门的员工姓名和工资"></a>1.查询和Zlotkey相同部门的员工姓名和工资</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Zlotkey&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="2-查询工资比公司平均工资高的员工的员工号，姓名和工资"><a href="#2-查询工资比公司平均工资高的员工的员工号，姓名和工资" class="headerlink" title="2.查询工资比公司平均工资高的员工的员工号，姓名和工资"></a>2.查询工资比公司平均工资高的员工的员工号，姓名和工资</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="3-选择工资大于所有job-id-x3D-‘SA-MAN’-的员工的工资的员工的last-name-job-id-salary"><a href="#3-选择工资大于所有job-id-x3D-‘SA-MAN’-的员工的工资的员工的last-name-job-id-salary" class="headerlink" title="3.选择工资大于所有job_id &#x3D; ‘SA_MAN’ 的员工的工资的员工的last_name, job_id, salary"></a>3.选择工资大于所有job_id &#x3D; ‘SA_MAN’ 的员工的工资的员工的last_name, job_id, salary</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="keyword">ALL</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="string">&#x27;SA_MAN&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="4-查询和姓名中包含字母u的员工在相同部门的员工的员工号和姓名"><a href="#4-查询和姓名中包含字母u的员工在相同部门的员工的员工号和姓名" class="headerlink" title="4.查询和姓名中包含字母u的员工在相同部门的员工的员工号和姓名"></a>4.查询和姓名中包含字母u的员工在相同部门的员工的员工号和姓名</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;%u%&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="5-查询在部门的location-id为1700的部门工作的员工的员工号"><a href="#5-查询在部门的location-id为1700的部门工作的员工的员工号" class="headerlink" title="5.查询在部门的location_id为1700的部门工作的员工的员工号"></a>5.查询在部门的location_id为1700的部门工作的员工的员工号</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> departments</span><br><span class="line">    <span class="keyword">WHERE</span> location_id <span class="operator">=</span> <span class="number">1700</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="6-查询管理者是King的员工姓名和工资"><a href="#6-查询管理者是King的员工姓名和工资" class="headerlink" title="6.查询管理者是King的员工姓名和工资"></a>6.查询管理者是King的员工姓名和工资</h5><p><img src="/../../../../../../imgs/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/image-20231012173916372.png" alt="image-20231012173916372"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> manage_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> employee_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;King&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="7-查询工资最低的员工信息-last-name-salary"><a href="#7-查询工资最低的员工信息-last-name-salary" class="headerlink" title="7.查询工资最低的员工信息 (last_name, salary)"></a>7.查询工资最低的员工信息 (last_name, salary)</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="8-查询平均工资最低的部门信息"><a href="#8-查询平均工资最低的部门信息" class="headerlink" title="8.查询平均工资最低的部门信息"></a>8.查询平均工资最低的部门信息</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># 方式一</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">=</span> (</span><br><span class="line">    	<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(avg_sal)</span><br><span class="line">        <span class="keyword">FROM</span> (</span><br><span class="line">        	<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">            <span class="keyword">FROM</span> employees</span><br><span class="line">            <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        ) t_dept_avg_sal</span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 方式二</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&lt;=</span> <span class="keyword">ALL</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 方式三: LIMIT</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">=</span> (</span><br><span class="line">    	<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_sal <span class="keyword">ASC</span></span><br><span class="line">        LIMIT <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 方式四</span><br><span class="line"><span class="keyword">SELECT</span> d.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> departments d, (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_sal <span class="keyword">ASC</span></span><br><span class="line">    LIMIT <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">) t_dept_avg_sal</span><br><span class="line"><span class="keyword">WHERE</span> d.`department_id` <span class="operator">=</span> t_dept_avg_sal.`department_id`;</span><br></pre></td></tr></table></figure>

<h5 id="9-查询平均工资最低的部门信息和该部门的平均工资-相关子查询"><a href="#9-查询平均工资最低的部门信息和该部门的平均工资-相关子查询" class="headerlink" title="9.查询平均工资最低的部门信息和该部门的平均工资 (相关子查询)"></a>9.查询平均工资最低的部门信息和该部门的平均工资 (相关子查询)</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：相关子查询</span><br><span class="line"><span class="keyword">SELECT</span> d.<span class="operator">*</span>, (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id <span class="operator">=</span> d.`department_id`) avg_sal</span><br><span class="line"><span class="keyword">FROM</span> departments d, (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_sal <span class="keyword">ASC</span></span><br><span class="line">    LIMIT <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">) t_dept_avg_sal</span><br><span class="line"><span class="keyword">WHERE</span> d.`department_id` <span class="operator">=</span> t_dept_avg_sal.`department_id`;</span><br><span class="line"></span><br><span class="line">#方式二：不相关子查询</span><br><span class="line"><span class="keyword">SELECT</span> d.<span class="operator">*</span>, t_dept_avg_sal.avg_sal avg_sal</span><br><span class="line"><span class="keyword">FROM</span> departments d, (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_sal <span class="keyword">ASC</span></span><br><span class="line">    LIMIT <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">) t_dept_avg_sal</span><br><span class="line"><span class="keyword">WHERE</span> d.`department_id` <span class="operator">=</span> t_dept_avg_sal.`department_id`;</span><br></pre></td></tr></table></figure>

<h5 id="10-查询平均工资最高的job信息"><a href="#10-查询平均工资最高的job信息" class="headerlink" title="10.查询平均工资最高的job信息"></a>10.查询平均工资最高的job信息</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> jobs</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">=</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> job_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&gt;=</span> <span class="keyword">ALL</span>(</span><br><span class="line">        	  				<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">              				<span class="keyword">FROM</span> employees</span><br><span class="line">                  			<span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="11-查询平均工资高于公司平均工资的部门有哪些"><a href="#11-查询平均工资高于公司平均工资的部门有哪些" class="headerlink" title="11.查询平均工资高于公司平均工资的部门有哪些"></a>11.查询平均工资高于公司平均工资的部门有哪些</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> depatment_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="12-查询出公司中所有manager的详细信息"><a href="#12-查询出公司中所有manager的详细信息" class="headerlink" title="12.查询出公司中所有manager的详细信息"></a>12.查询出公司中所有manager的详细信息</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 方式<span class="number">1</span>：自连接</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager.employee_id, manager.last_name</span><br><span class="line"><span class="keyword">FROM</span> employees emp, employees manager</span><br><span class="line"><span class="keyword">WHERE</span> emp.`manager_id` <span class="operator">=</span> manager.`employee_id`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager.employee_id, manager.last_name</span><br><span class="line"><span class="keyword">FROM</span> employees emp <span class="keyword">JOIN</span> employees manager</span><br><span class="line"><span class="keyword">ON</span> emp.`manager_id` <span class="operator">=</span> manager.`employee_id`; </span><br><span class="line"></span><br><span class="line"># 方式<span class="number">2</span>：子查询</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 方式<span class="number">3</span>：<span class="keyword">EXISTS</span></span><br><span class="line"><span class="keyword">SELECT</span> manager.employee_id, manager.last_name</span><br><span class="line"><span class="keyword">FROM</span> employees manager</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span> employees emp</span><br><span class="line">    <span class="keyword">WHERE</span> manager.`employee_id` <span class="operator">=</span> emp.`manager_id`</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="13-各个部门中，最高工资中最低的那个部门的最低工资是多少"><a href="#13-各个部门中，最高工资中最低的那个部门的最低工资是多少" class="headerlink" title="13.各个部门中，最高工资中最低的那个部门的最低工资是多少"></a>13.各个部门中，最高工资中最低的那个部门的最低工资是多少</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">	<span class="keyword">HAVING</span> <span class="built_in">MAX</span>(salary) <span class="operator">=</span> (</span><br><span class="line">    	<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(max_sal)</span><br><span class="line">        <span class="keyword">FROM</span> (</span><br><span class="line">        	<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) max_sal</span><br><span class="line">            <span class="keyword">FROM</span> employees</span><br><span class="line">            <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        ) t_dept_max_sal</span><br><span class="line">    ) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 方式二：</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">	<span class="keyword">HAVING</span> <span class="built_in">MAX</span>(salary) <span class="operator">&lt;=</span> <span class="keyword">ALL</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary)</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">    ) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 方式三：</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">	<span class="keyword">HAVING</span> <span class="built_in">MAX</span>(salary) <span class="operator">=</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) max_sal</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> max_sal <span class="keyword">ASC</span></span><br><span class="line">        LIMIT <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">    ) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 方式四：</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(e.salary)</span><br><span class="line"><span class="keyword">FROM</span> employees e, (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id, <span class="built_in">MAX</span>(salary) max_sal</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> max_sal <span class="keyword">ASC</span></span><br><span class="line">    LIMIT <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">) t_dept_max_sal</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> t_dept_max_sal.`department_id`;</span><br></pre></td></tr></table></figure>

<h5 id="14-查询平均工资最高的部门的manager的详细信息：last-name-department-id-email-salary"><a href="#14-查询平均工资最高的部门的manager的详细信息：last-name-department-id-email-salary" class="headerlink" title="14.查询平均工资最高的部门的manager的详细信息：last_name, department_id, email, salary"></a>14.查询平均工资最高的部门的manager的详细信息：last_name, department_id, email, salary</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="operator">=</span> (<span class="keyword">SELECT</span> d.manager_id</span><br><span class="line">										 <span class="keyword">FROM</span> departments d</span><br><span class="line">										 <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> &quot;avg_sal&quot;</span><br><span class="line">													 <span class="keyword">FROM</span> employees</span><br><span class="line">			                     <span class="keyword">WHERE</span> department_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">			                     <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">			                     <span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_sal</span><br><span class="line">			                     LIMIT <span class="number">1</span>) t_dept_avg_sal <span class="keyword">ON</span> d.department_id <span class="operator">=</span> t_dept_avg_sal.department_id);</span><br></pre></td></tr></table></figure>

<h5 id="15-查询部门的部门号，其中不包括job-id是”ST-CLERK”的部门号"><a href="#15-查询部门的部门号，其中不包括job-id是”ST-CLERK”的部门号" class="headerlink" title="15.查询部门的部门号，其中不包括job_id是”ST_CLERK”的部门号"></a>15.查询部门的部门号，其中不包括job_id是”ST_CLERK”的部门号</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> job_id <span class="operator">=</span> `ST_CLERK`</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> d.department_id</span><br><span class="line"><span class="keyword">FROM</span> department d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span> employees e</span><br><span class="line">    <span class="keyword">WHERE</span> d.`department_id` <span class="operator">=</span> e.`department_id`</span><br><span class="line">    <span class="keyword">AND</span> e.`job_id` <span class="operator">=</span> <span class="string">&#x27;ST_CLERK&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="16-选择所有没有管理者的员工的last-name"><a href="#16-选择所有没有管理者的员工的last-name" class="headerlink" title="16.选择所有没有管理者的员工的last_name"></a>16.选择所有没有管理者的员工的last_name</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> emp.last_name</span><br><span class="line"><span class="keyword">FROM</span> employees emp</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span> employees mgr</span><br><span class="line">    <span class="keyword">WHERE</span> emp.`manager_id` <span class="operator">=</span> mgr.`employee_id`</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="17-查询员工号、姓名、雇用时间、工资，其中员工的管理者为-‘De-Haan’"><a href="#17-查询员工号、姓名、雇用时间、工资，其中员工的管理者为-‘De-Haan’" class="headerlink" title="17.查询员工号、姓名、雇用时间、工资，其中员工的管理者为 ‘De Haan’"></a>17.查询员工号、姓名、雇用时间、工资，其中员工的管理者为 ‘De Haan’</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, hire_date, salary</span><br><span class="line"><span class="keyword">FROM</span> employee</span><br><span class="line"><span class="keyword">WHERE</span> manager_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> manager_id</span><br><span class="line">    <span class="keyword">FROM</span> employee</span><br><span class="line">    <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;De Haan&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="18-查询各部门中工资比本部门平均工资高的员工的员工号，姓名和工资（相关子查询）"><a href="#18-查询各部门中工资比本部门平均工资高的员工的员工号，姓名和工资（相关子查询）" class="headerlink" title="18.查询各部门中工资比本部门平均工资高的员工的员工号，姓名和工资（相关子查询）"></a>18.查询各部门中工资比本部门平均工资高的员工的员工号，姓名和工资（相关子查询）</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e1.department_id, e1.last_name, e1.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">WHERE</span> e1.salary <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees e2</span><br><span class="line">    <span class="keyword">WHERE</span> e2.`department_id` <span class="operator">=</span> e1.`department_id`</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.last_name, e.salary, e.department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e, (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">) t_dept_avg_sal</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> t_dept_avg_sal.`department_id`</span><br><span class="line"><span class="keyword">AND</span> e.`salary` <span class="operator">&gt;</span> t_dept_avg_sal.`avg_sal`;</span><br></pre></td></tr></table></figure>

<h5 id="19-查询每个部门下的部门人数大于5的部门名称（相关子查询）"><a href="#19-查询每个部门下的部门人数大于5的部门名称（相关子查询）" class="headerlink" title="19.查询每个部门下的部门人数大于5的部门名称（相关子查询）"></a>19.查询每个部门下的部门人数大于5的部门名称（相关子查询）</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">5</span> <span class="operator">&lt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">FROM</span> employees e</span><br><span class="line">    <span class="keyword">WHERE</span> d.`department_id` <span class="operator">=</span> e.`department_id`</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="20-查询每个国家下的部门个数大于2的国家编号（相关子查询）"><a href="#20-查询每个国家下的部门个数大于2的国家编号（相关子查询）" class="headerlink" title="20.查询每个国家下的部门个数大于2的国家编号（相关子查询）"></a>20.查询每个国家下的部门个数大于2的国家编号（相关子查询）</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> country_id</span><br><span class="line"><span class="keyword">FROM</span> locations l</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">2</span> <span class="operator">&lt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">FROM</span> department d</span><br><span class="line">    <span class="keyword">WHERE</span> l.`location_id` <span class="operator">=</span> d.`location_id`</span><br><span class="line">);</span><br></pre></td></tr></table></figure>


  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/hulingF">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.</span> <span class="toc-text">MySQL基础-子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%BC%95%E5%85%A5"><span class="toc-number">1.1.</span> <span class="toc-text">一、子查询的引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">二、子查询的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%8D%95%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.</span> <span class="toc-text">三、单行子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8D%95%E8%A1%8C%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.单行比较操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.代码示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-HAVING%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.HAVING中的子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-CASE%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.4.</span> <span class="toc-text">4.CASE中的子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%9D%9E%E6%B3%95%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.5.</span> <span class="toc-text">5.非法使用子查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%A4%9A%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.</span> <span class="toc-text">四、多行子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%A4%9A%E8%A1%8C%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.多行比较操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">1.4.2.</span> <span class="toc-text">2.代码示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%A9%BA%E5%80%BC%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.3.</span> <span class="toc-text">3.空值问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.</span> <span class="toc-text">五、相关子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.代码示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%9B%B8%E5%85%B3%E6%9B%B4%E6%96%B0"><span class="toc-number">1.5.2.</span> <span class="toc-text">2.相关更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%9B%B8%E5%85%B3%E5%88%A0%E9%99%A4"><span class="toc-number">1.5.3.</span> <span class="toc-text">3.相关删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%80%A7%E8%83%BD%E6%80%9D%E8%80%83"><span class="toc-number">1.6.</span> <span class="toc-text">六、性能思考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E8%AF%BE%E5%90%8E%E7%BB%83%E4%B9%A0"><span class="toc-number">1.7.</span> <span class="toc-text">七、课后练习</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%9F%A5%E8%AF%A2%E5%92%8CZlotkey%E7%9B%B8%E5%90%8C%E9%83%A8%E9%97%A8%E7%9A%84%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%E5%92%8C%E5%B7%A5%E8%B5%84"><span class="toc-number">1.7.0.0.1.</span> <span class="toc-text">1.查询和Zlotkey相同部门的员工姓名和工资</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%9F%A5%E8%AF%A2%E5%B7%A5%E8%B5%84%E6%AF%94%E5%85%AC%E5%8F%B8%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E9%AB%98%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84%E5%91%98%E5%B7%A5%E5%8F%B7%EF%BC%8C%E5%A7%93%E5%90%8D%E5%92%8C%E5%B7%A5%E8%B5%84"><span class="toc-number">1.7.0.0.2.</span> <span class="toc-text">2.查询工资比公司平均工资高的员工的员工号，姓名和工资</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%80%89%E6%8B%A9%E5%B7%A5%E8%B5%84%E5%A4%A7%E4%BA%8E%E6%89%80%E6%9C%89job-id-x3D-%E2%80%98SA-MAN%E2%80%99-%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84%E5%B7%A5%E8%B5%84%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84last-name-job-id-salary"><span class="toc-number">1.7.0.0.3.</span> <span class="toc-text">3.选择工资大于所有job_id &#x3D; ‘SA_MAN’ 的员工的工资的员工的last_name, job_id, salary</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%A7%93%E5%90%8D%E4%B8%AD%E5%8C%85%E5%90%AB%E5%AD%97%E6%AF%8Du%E7%9A%84%E5%91%98%E5%B7%A5%E5%9C%A8%E7%9B%B8%E5%90%8C%E9%83%A8%E9%97%A8%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84%E5%91%98%E5%B7%A5%E5%8F%B7%E5%92%8C%E5%A7%93%E5%90%8D"><span class="toc-number">1.7.0.0.4.</span> <span class="toc-text">4.查询和姓名中包含字母u的员工在相同部门的员工的员工号和姓名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%9F%A5%E8%AF%A2%E5%9C%A8%E9%83%A8%E9%97%A8%E7%9A%84location-id%E4%B8%BA1700%E7%9A%84%E9%83%A8%E9%97%A8%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84%E5%91%98%E5%B7%A5%E5%8F%B7"><span class="toc-number">1.7.0.0.5.</span> <span class="toc-text">5.查询在部门的location_id为1700的部门工作的员工的员工号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E6%9F%A5%E8%AF%A2%E7%AE%A1%E7%90%86%E8%80%85%E6%98%AFKing%E7%9A%84%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%E5%92%8C%E5%B7%A5%E8%B5%84"><span class="toc-number">1.7.0.0.6.</span> <span class="toc-text">6.查询管理者是King的员工姓名和工资</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-%E6%9F%A5%E8%AF%A2%E5%B7%A5%E8%B5%84%E6%9C%80%E4%BD%8E%E7%9A%84%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF-last-name-salary"><span class="toc-number">1.7.0.0.7.</span> <span class="toc-text">7.查询工资最低的员工信息 (last_name, salary)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-%E6%9F%A5%E8%AF%A2%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E6%9C%80%E4%BD%8E%E7%9A%84%E9%83%A8%E9%97%A8%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.0.0.8.</span> <span class="toc-text">8.查询平均工资最低的部门信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-%E6%9F%A5%E8%AF%A2%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E6%9C%80%E4%BD%8E%E7%9A%84%E9%83%A8%E9%97%A8%E4%BF%A1%E6%81%AF%E5%92%8C%E8%AF%A5%E9%83%A8%E9%97%A8%E7%9A%84%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84-%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.7.0.0.9.</span> <span class="toc-text">9.查询平均工资最低的部门信息和该部门的平均工资 (相关子查询)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-%E6%9F%A5%E8%AF%A2%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E6%9C%80%E9%AB%98%E7%9A%84job%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.0.0.10.</span> <span class="toc-text">10.查询平均工资最高的job信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#11-%E6%9F%A5%E8%AF%A2%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E9%AB%98%E4%BA%8E%E5%85%AC%E5%8F%B8%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E7%9A%84%E9%83%A8%E9%97%A8%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">1.7.0.0.11.</span> <span class="toc-text">11.查询平均工资高于公司平均工资的部门有哪些</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#12-%E6%9F%A5%E8%AF%A2%E5%87%BA%E5%85%AC%E5%8F%B8%E4%B8%AD%E6%89%80%E6%9C%89manager%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.0.0.12.</span> <span class="toc-text">12.查询出公司中所有manager的详细信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#13-%E5%90%84%E4%B8%AA%E9%83%A8%E9%97%A8%E4%B8%AD%EF%BC%8C%E6%9C%80%E9%AB%98%E5%B7%A5%E8%B5%84%E4%B8%AD%E6%9C%80%E4%BD%8E%E7%9A%84%E9%82%A3%E4%B8%AA%E9%83%A8%E9%97%A8%E7%9A%84%E6%9C%80%E4%BD%8E%E5%B7%A5%E8%B5%84%E6%98%AF%E5%A4%9A%E5%B0%91"><span class="toc-number">1.7.0.0.13.</span> <span class="toc-text">13.各个部门中，最高工资中最低的那个部门的最低工资是多少</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#14-%E6%9F%A5%E8%AF%A2%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E6%9C%80%E9%AB%98%E7%9A%84%E9%83%A8%E9%97%A8%E7%9A%84manager%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%EF%BC%9Alast-name-department-id-email-salary"><span class="toc-number">1.7.0.0.14.</span> <span class="toc-text">14.查询平均工资最高的部门的manager的详细信息：last_name, department_id, email, salary</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#15-%E6%9F%A5%E8%AF%A2%E9%83%A8%E9%97%A8%E7%9A%84%E9%83%A8%E9%97%A8%E5%8F%B7%EF%BC%8C%E5%85%B6%E4%B8%AD%E4%B8%8D%E5%8C%85%E6%8B%ACjob-id%E6%98%AF%E2%80%9DST-CLERK%E2%80%9D%E7%9A%84%E9%83%A8%E9%97%A8%E5%8F%B7"><span class="toc-number">1.7.0.0.15.</span> <span class="toc-text">15.查询部门的部门号，其中不包括job_id是”ST_CLERK”的部门号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#16-%E9%80%89%E6%8B%A9%E6%89%80%E6%9C%89%E6%B2%A1%E6%9C%89%E7%AE%A1%E7%90%86%E8%80%85%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84last-name"><span class="toc-number">1.7.0.0.16.</span> <span class="toc-text">16.选择所有没有管理者的员工的last_name</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#17-%E6%9F%A5%E8%AF%A2%E5%91%98%E5%B7%A5%E5%8F%B7%E3%80%81%E5%A7%93%E5%90%8D%E3%80%81%E9%9B%87%E7%94%A8%E6%97%B6%E9%97%B4%E3%80%81%E5%B7%A5%E8%B5%84%EF%BC%8C%E5%85%B6%E4%B8%AD%E5%91%98%E5%B7%A5%E7%9A%84%E7%AE%A1%E7%90%86%E8%80%85%E4%B8%BA-%E2%80%98De-Haan%E2%80%99"><span class="toc-number">1.7.0.0.17.</span> <span class="toc-text">17.查询员工号、姓名、雇用时间、工资，其中员工的管理者为 ‘De Haan’</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#18-%E6%9F%A5%E8%AF%A2%E5%90%84%E9%83%A8%E9%97%A8%E4%B8%AD%E5%B7%A5%E8%B5%84%E6%AF%94%E6%9C%AC%E9%83%A8%E9%97%A8%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E9%AB%98%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84%E5%91%98%E5%B7%A5%E5%8F%B7%EF%BC%8C%E5%A7%93%E5%90%8D%E5%92%8C%E5%B7%A5%E8%B5%84%EF%BC%88%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">1.7.0.0.18.</span> <span class="toc-text">18.查询各部门中工资比本部门平均工资高的员工的员工号，姓名和工资（相关子查询）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#19-%E6%9F%A5%E8%AF%A2%E6%AF%8F%E4%B8%AA%E9%83%A8%E9%97%A8%E4%B8%8B%E7%9A%84%E9%83%A8%E9%97%A8%E4%BA%BA%E6%95%B0%E5%A4%A7%E4%BA%8E5%E7%9A%84%E9%83%A8%E9%97%A8%E5%90%8D%E7%A7%B0%EF%BC%88%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">1.7.0.0.19.</span> <span class="toc-text">19.查询每个部门下的部门人数大于5的部门名称（相关子查询）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#20-%E6%9F%A5%E8%AF%A2%E6%AF%8F%E4%B8%AA%E5%9B%BD%E5%AE%B6%E4%B8%8B%E7%9A%84%E9%83%A8%E9%97%A8%E4%B8%AA%E6%95%B0%E5%A4%A7%E4%BA%8E2%E7%9A%84%E5%9B%BD%E5%AE%B6%E7%BC%96%E5%8F%B7%EF%BC%88%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">1.7.0.0.20.</span> <span class="toc-text">20.查询每个国家下的部门个数大于2的国家编号（相关子查询）</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&text=MySQL基础-子查询"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&title=MySQL基础-子查询"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&is_video=false&description=MySQL基础-子查询"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=MySQL基础-子查询&body=Check out this article: https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&title=MySQL基础-子查询"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&title=MySQL基础-子查询"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&title=MySQL基础-子查询"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&title=MySQL基础-子查询"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&name=MySQL基础-子查询&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://hulingf.github.io/2023/10/12/MySQL%E5%9F%BA%E7%A1%80-%E5%AD%90%E6%9F%A5%E8%AF%A2/&t=MySQL基础-子查询"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024
    hulingF
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/hulingF">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'hulingF';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
