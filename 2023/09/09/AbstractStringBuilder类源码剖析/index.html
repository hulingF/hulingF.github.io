<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="AbstractStringBuilder类源码剖析一、AbstractStringBuilder类的简介AbstractStringBuilder类代表可变字符序列，实现可修改的字符串，在任何时间点，它都包含一些特定的字符序列，但序列的长度和内容可以通过某些方法调用来更改。除非另有说明，否则将null参数传递给此类中的构造函数或方法将导致引发NullPointerException。  Abst">
<meta property="og:type" content="article">
<meta property="og:title" content="AbstractStringBuilder类源码剖析">
<meta property="og:url" content="https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/index.html">
<meta property="og:site_name" content="大军的秘密花园">
<meta property="og:description" content="AbstractStringBuilder类源码剖析一、AbstractStringBuilder类的简介AbstractStringBuilder类代表可变字符序列，实现可修改的字符串，在任何时间点，它都包含一些特定的字符序列，但序列的长度和内容可以通过某些方法调用来更改。除非另有说明，否则将null参数传递给此类中的构造函数或方法将导致引发NullPointerException。  Abst">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hulingf.github.io/imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230909153931911.png">
<meta property="og:image" content="https://hulingf.github.io/imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911150030534.png">
<meta property="og:image" content="https://hulingf.github.io/imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911201307780.png">
<meta property="og:image" content="https://hulingf.github.io/imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911165136394.png">
<meta property="og:image" content="https://hulingf.github.io/imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911172944214.png">
<meta property="og:image" content="https://hulingf.github.io/imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911174356480.png">
<meta property="og:image" content="https://hulingf.github.io/imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911191912514.png">
<meta property="og:image" content="https://hulingf.github.io/imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911194021699.png">
<meta property="og:image" content="https://hulingf.github.io/imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911163713755.png">
<meta property="article:published_time" content="2023-09-09T05:29:58.406Z">
<meta property="article:modified_time" content="2023-12-07T09:00:42.824Z">
<meta property="article:author" content="hulingF">
<meta property="article:tag" content="JDK源码">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hulingf.github.io/imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230909153931911.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>AbstractStringBuilder类源码剖析</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/hulingF">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/09/13/StringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/09/08/String%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&text=AbstractStringBuilder类源码剖析"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&title=AbstractStringBuilder类源码剖析"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&is_video=false&description=AbstractStringBuilder类源码剖析"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=AbstractStringBuilder类源码剖析&body=Check out this article: https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&title=AbstractStringBuilder类源码剖析"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&title=AbstractStringBuilder类源码剖析"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&title=AbstractStringBuilder类源码剖析"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&title=AbstractStringBuilder类源码剖析"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&name=AbstractStringBuilder类源码剖析&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&t=AbstractStringBuilder类源码剖析"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">AbstractStringBuilder类源码剖析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">一、AbstractStringBuilder类的简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="toc-number">1.2.</span> <span class="toc-text">二、AbstractStringBuilder类的字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">三、AbstractStringBuilder类的构造方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E4%B8%80%E4%BA%9B%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.</span> <span class="toc-text">四、AbstractStringBuilder类的一些方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E6%9F%A5%E6%89%BE%E6%96%B9%E6%B3%95"><span class="toc-number">1.5.</span> <span class="toc-text">五、AbstractStringBuilder类的查找方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E6%B7%BB%E5%8A%A0%E6%96%B9%E6%B3%95"><span class="toc-number">1.6.</span> <span class="toc-text">六、AbstractStringBuilder类的添加方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E5%88%A0%E9%99%A4%E6%96%B9%E6%B3%95"><span class="toc-number">1.7.</span> <span class="toc-text">七、AbstractStringBuilder类的删除方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E4%BF%AE%E6%94%B9%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.</span> <span class="toc-text">八、AbstractStringBuilder类的修改方法</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        AbstractStringBuilder类源码剖析
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">hulingF</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-09-09T05:29:58.406Z" class="dt-published" itemprop="datePublished">2023-09-09</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/JDK%E6%BA%90%E7%A0%81/" rel="tag">JDK源码</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="AbstractStringBuilder类源码剖析"><a href="#AbstractStringBuilder类源码剖析" class="headerlink" title="AbstractStringBuilder类源码剖析"></a>AbstractStringBuilder类源码剖析</h1><h2 id="一、AbstractStringBuilder类的简介"><a href="#一、AbstractStringBuilder类的简介" class="headerlink" title="一、AbstractStringBuilder类的简介"></a>一、AbstractStringBuilder类的简介</h2><p>AbstractStringBuilder类代表<code>可变字符序列</code>，实现可修改的字符串，在任何时间点，它都包含一些特定的字符序列，但序列的长度和内容可以通过某些方法调用来更改。除非另有说明，否则将null参数传递给此类中的构造函数或方法将导致引发NullPointerException。</p>
<p><img src="/../../../../../../imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230909153931911.png" alt="image-20230909153931911"></p>
<p>AbstractStringBuilder类实现了两个接口<code>Appendable</code>和<code>CharSequence</code>，Appendable接口表明可以往该类添加字符序列，Appendable接口本身不保证<code>多线程访问的安全性</code>，具体内容由继承的子类选择是否实现，CharSequence接口表明该类是一个可读的字符序列，并且为不同类型的字符序列(具体的实现类)提供了通用的、只读的访问方法，其中中的字符值(<code>char码元</code>)表示BMP内的一个码位或者辅助平面的一个高&#x2F;低位代理项(<code>surrogate</code>)。</p>
<blockquote>
<p>注意CharSequence接口本身没有完善equals和hashCode方法的一般规约，因此继承了CharSequence接口的两个不同类直接的相等性比较是未定义的，因此，将任意CharSequence实例用作set中的元素或map中的键是不合适的。</p>
</blockquote>
<h2 id="二、AbstractStringBuilder类的字段"><a href="#二、AbstractStringBuilder类的字段" class="headerlink" title="二、AbstractStringBuilder类的字段"></a>二、AbstractStringBuilder类的字段</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 存储字符序列的实际字节数组</span></span><br><span class="line"><span class="type">byte</span>[] value;</span><br><span class="line"><span class="comment">// 针对value的编码字段</span></span><br><span class="line"><span class="type">byte</span> coder;</span><br><span class="line"><span class="comment">// 已经使用的字符数量</span></span><br><span class="line"><span class="type">int</span> count;</span><br><span class="line"><span class="comment">// 预定义的空字节数组</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] EMPTYVALUE = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// 待分配的数组的最大长度，之所以是Integer.MAX_VALUE-8是因为[某些]VM会在数组中保留一些标头字。尝试分配更大的数组可能会导致OutOfMemoryError即请求的数组大小超过VM限制</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_ARRAY_SIZE</span> <span class="operator">=</span> Integer.MAX_VALUE - <span class="number">8</span>;</span><br></pre></td></tr></table></figure>

<p>作为可变字符串的经典代表，AbstractStringBuilder的字段跟String的非常相似，具体含义也是基本保持一致。&#x3D;&#x3D;尤其注意，count字段表示使用的字符数量，coder采用LATIN1时单个字节表示一个字符，coder采用UTF-16时双字节表示一个字符&#x3D;&#x3D;。</p>
<h2 id="三、AbstractStringBuilder类的构造方法"><a href="#三、AbstractStringBuilder类的构造方法" class="headerlink" title="三、AbstractStringBuilder类的构造方法"></a>三、AbstractStringBuilder类的构造方法</h2><p>第一个是无参构造方法，源代码注释里面提到<code>这个无参构造函数对于子类的序列化来说是必要的</code>。这很重要，因为如果父类既没有实现Serializable接口也没有无参构造方法，那么当子类实现了Serializable接口后进行序列化与反序列化时会抛出异常（具体来说序列化时忽略父类，反序列化时因为缺少父类的无参构造函数导致<code>InvalidClassException</code>）。</p>
<p><img src="/../../../../../../imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911150030534.png" alt="image-20230911150030534"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AbstractStringBuilder() &#123;</span><br><span class="line">    value = EMPTYVALUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二个是含有容量参数的构造方法，当<code>COMPACT_STRINGS</code>选项开启时(默认开启)，AbstractStringBuilder采用<code>LATIN1</code>编码方式存储字符序列数据，否则转而使用<code>UTF16</code>编码方式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">AbstractStringBuilder(<span class="type">int</span> capacity) &#123;</span><br><span class="line">    <span class="keyword">if</span> (COMPACT_STRINGS) &#123;</span><br><span class="line">        value = <span class="keyword">new</span> <span class="title class_">byte</span>[capacity];</span><br><span class="line">        coder = LATIN1;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        value = StringUTF16.newBytesFor(capacity);</span><br><span class="line">        coder = UTF16;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、AbstractStringBuilder类的一些方法"><a href="#四、AbstractStringBuilder类的一些方法" class="headerlink" title="四、AbstractStringBuilder类的一些方法"></a>四、AbstractStringBuilder类的一些方法</h2><p><code>compareTo</code>也是非常简单的一个方法，就是按照字典顺序比较两个AbstractStringBuilder对象的大小，主要需要考虑比较的两个对象是否采用一致的编码方式，如果一致（都是<code>LATIN1</code>或者<code>UTF16</code>）直接从前往后依次取字符比较即可，对于LATIN1来说单字节表示一个字符，对于UTF16来说双字节表示一个char码元（基本多语言平面的字符或者辅助平面的代理字符项）。如果编码方式不一样的话，需要根据编码方式的特点从前往后分别取出相应位置的字符比较，其中StringUTF16.compareToLatin1<code>复用</code>StringLatin1.compareToUTF16的实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(AbstractStringBuilder another)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span> == another) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">byte</span> val1[] = value;</span><br><span class="line">    <span class="type">byte</span> val2[] = another.value;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count1</span> <span class="operator">=</span> <span class="built_in">this</span>.count;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count2</span> <span class="operator">=</span> another.count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (coder == another.coder) &#123;</span><br><span class="line">        <span class="keyword">return</span> isLatin1() ? StringLatin1.compareTo(val1, val2, count1, count2)</span><br><span class="line">            : StringUTF16.compareTo(val1, val2, count1, count2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isLatin1() ? StringLatin1.compareToUTF16(val1, val2, count1, count2)</span><br><span class="line">        : StringUTF16.compareToLatin1(val1, val2, count1, count2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../../../../../../imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911201307780.png" alt="image-20230911201307780"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">reverse</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[] val = <span class="built_in">this</span>.value;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.count;</span><br><span class="line">    <span class="type">int</span> <span class="variable">coder</span> <span class="operator">=</span> <span class="built_in">this</span>.coder;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> count - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (COMPACT_STRINGS &amp;&amp; coder == LATIN1) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> (n-<span class="number">1</span>) &gt;&gt; <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> n - j;</span><br><span class="line">            <span class="type">byte</span> <span class="variable">cj</span> <span class="operator">=</span> val[j];</span><br><span class="line">            val[j] = val[k];</span><br><span class="line">            val[k] = cj;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        StringUTF16.reverse(val, count);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、AbstractStringBuilder类的查找方法"><a href="#五、AbstractStringBuilder类的查找方法" class="headerlink" title="五、AbstractStringBuilder类的查找方法"></a>五、AbstractStringBuilder类的查找方法</h2><p><code>length</code>方法返回此对象当前表示的字符序列的长度。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">length</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>capacity</code>方法返回当前容量。容量是可用于新插入字符的存储量，超出该存储量将进行分配。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">capacity</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> value.length &gt;&gt; coder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>charAt</code>方法返回指定索引位置的字符（如果是UTF16的代理项也要返回）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">char</span> <span class="title function_">charAt</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    checkIndex(index, count);</span><br><span class="line">    <span class="keyword">if</span> (isLatin1()) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">char</span>)(value[index] &amp; <span class="number">0xff</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> StringUTF16.charAt(value, index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StringUTF16.charAt</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">charAt</span><span class="params">(<span class="type">byte</span>[] value, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">    checkIndex(index, value);</span><br><span class="line">    <span class="keyword">return</span> getChar(value, index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>codePointAt</code>与charAt类似，不过该方法返回的是<code>码位</code>，如果指定索引位置的字符码元是高代理项，并且后一个字符码元是低代理项同时未超出字符序列的长度，则返回由高、低位代理对共同组成的<code>增补字符码位</code>。</p>
<p><img src="/../../../../../../imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911165136394.png" alt="image-20230911165136394"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">codePointAt</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.count;</span><br><span class="line">    <span class="type">byte</span>[] value = <span class="built_in">this</span>.value;</span><br><span class="line">    checkIndex(index, count);</span><br><span class="line">    <span class="comment">// Lantin1编码直接返回数组索引处的字符码位</span></span><br><span class="line">    <span class="keyword">if</span> (isLatin1()) &#123;</span><br><span class="line">        <span class="keyword">return</span> value[index] &amp; <span class="number">0xff</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// UTF16编码针对基本/辅助多语言平面内的字符码位作不同的处理</span></span><br><span class="line">    <span class="keyword">return</span> StringUTF16.codePointAtSB(value, index, count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最终调用到StringUTF16的这个方法</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">codePointAt</span><span class="params">(<span class="type">byte</span>[] value, <span class="type">int</span> index, <span class="type">int</span> end, <span class="type">boolean</span> checked)</span> &#123;</span><br><span class="line">    <span class="keyword">assert</span> index &lt; end;</span><br><span class="line">    <span class="keyword">if</span> (checked) &#123;</span><br><span class="line">        checkIndex(index, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">char</span> <span class="variable">c1</span> <span class="operator">=</span> getChar(value, index);</span><br><span class="line">    <span class="keyword">if</span> (Character.isHighSurrogate(c1) &amp;&amp; ++index &lt; end) &#123;</span><br><span class="line">        <span class="keyword">if</span> (checked) &#123;</span><br><span class="line">            checkIndex(index, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c2</span> <span class="operator">=</span> getChar(value, index);</span><br><span class="line">        <span class="keyword">if</span> (Character.isLowSurrogate(c2)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Character.toCodePoint(c1, c2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>getChars</code>方法返回由<code>srcBegin</code>、<code>srcEnd</code>确定的字符序列范围[srcBegin,srcEnd)并拷贝至目标字符数组中。</p>
<p><img src="/../../../../../../imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911172944214.png" alt="image-20230911172944214"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getChars</span><span class="params">(<span class="type">int</span> srcBegin, <span class="type">int</span> srcEnd, <span class="type">char</span>[] dst, <span class="type">int</span> dstBegin)</span></span><br><span class="line">&#123;</span><br><span class="line">    checkRangeSIOOBE(srcBegin, srcEnd, count);  <span class="comment">// compatible to old version</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> srcEnd - srcBegin;</span><br><span class="line">    checkRange(dstBegin, dstBegin + n, dst.length);</span><br><span class="line">    <span class="keyword">if</span> (isLatin1()) &#123;</span><br><span class="line">        StringLatin1.getChars(value, srcBegin, srcEnd, dst, dstBegin);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        StringUTF16.getChars(value, srcBegin, srcEnd, dst, dstBegin);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StringLatin1.getChars</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getChars</span><span class="params">(<span class="type">byte</span>[] value, <span class="type">int</span> srcBegin, <span class="type">int</span> srcEnd, <span class="type">char</span> dst[], <span class="type">int</span> dstBegin)</span> &#123;</span><br><span class="line">    inflate(value, srcBegin, dst, dstBegin, srcEnd - srcBegin);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StringLatin1.inflate</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">inflate</span><span class="params">(<span class="type">byte</span>[] src, <span class="type">int</span> srcOff, <span class="type">char</span>[] dst, <span class="type">int</span> dstOff, <span class="type">int</span> len)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        dst[dstOff++] = (<span class="type">char</span>)(src[srcOff++] &amp; <span class="number">0xff</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StringUTF16.getChars</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getChars</span><span class="params">(<span class="type">byte</span>[] value, <span class="type">int</span> srcBegin, <span class="type">int</span> srcEnd, <span class="type">char</span> dst[], <span class="type">int</span> dstBegin)</span> &#123;</span><br><span class="line">    <span class="comment">// We need a range check here because &#x27;getChar&#x27; has no checks</span></span><br><span class="line">    <span class="keyword">if</span> (srcBegin &lt; srcEnd) &#123;</span><br><span class="line">        checkBoundsOffCount(srcBegin, srcEnd - srcBegin, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> srcBegin; i &lt; srcEnd; i++) &#123;</span><br><span class="line">        dst[dstBegin++] = getChar(value, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、AbstractStringBuilder类的添加方法"><a href="#六、AbstractStringBuilder类的添加方法" class="headerlink" title="六、AbstractStringBuilder类的添加方法"></a>六、AbstractStringBuilder类的添加方法</h2><p><code>append</code>方法有很多重载，下面这个就是把<code>String.valueOf(obj)</code>追加到该类表示的字符序列。</p>
<p><img src="/../../../../../../imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911174356480.png" alt="image-20230911174356480"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">append</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> append(String.valueOf(obj));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">append</span><span class="params">(String str)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> appendNull();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> str.length();</span><br><span class="line">    <span class="comment">// 需要保证字符容量能够承载下追加字符串后的字符总数</span></span><br><span class="line">    ensureCapacityInternal(count + len);</span><br><span class="line">    <span class="comment">// 在count字符索引处追加字符串</span></span><br><span class="line">    putStringAt(count, str);</span><br><span class="line">    <span class="comment">// 修改已使用字符的数量</span></span><br><span class="line">    count += len;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">putStringAt</span><span class="params">(<span class="type">int</span> index, String str)</span> &#123;</span><br><span class="line">    <span class="comment">// 可变字符序列的编码方案与添加的字符串编码方案不一致，需要先把可变字符序列编码方案升级为UTF16</span></span><br><span class="line">    <span class="keyword">if</span> (getCoder() != str.coder()) &#123;</span><br><span class="line">        inflate();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加的字符串的内容拷贝至可变字符序列中</span></span><br><span class="line">    str.getBytes(value, index, coder);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可变字符串的编码方案修改为UTF-16</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">inflate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isLatin1()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">byte</span>[] buf = StringUTF16.newBytesFor(value.length);</span><br><span class="line">    StringLatin1.inflate(value, <span class="number">0</span>, buf, <span class="number">0</span>, count);</span><br><span class="line">    <span class="built_in">this</span>.value = buf;</span><br><span class="line">    <span class="built_in">this</span>.coder = UTF16;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>append</code>方法的另一种重载可以追加<code>AbstractStringBuilder</code>对象，具体逻辑也很简单，见下面代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Documentation in subclasses because of synchro difference</span></span><br><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">append</span><span class="params">(StringBuffer sb)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.append((AbstractStringBuilder)sb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AbstractStringBuilder <span class="title function_">append</span><span class="params">(AbstractStringBuilder asb)</span> &#123;</span><br><span class="line">    <span class="comment">// 如果传入的asb参数为null，则追加&quot;null&quot;四个字符</span></span><br><span class="line">    <span class="keyword">if</span> (asb == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> appendNull();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> asb.length();</span><br><span class="line">    <span class="comment">// 确保容量足够</span></span><br><span class="line">    ensureCapacityInternal(count + len);</span><br><span class="line">    <span class="comment">// 如果编码方式不一致，则把该类的字符序列改为UTF16编码（如果本来就是UTF16则忽略）</span></span><br><span class="line">    <span class="keyword">if</span> (getCoder() != asb.getCoder()) &#123;</span><br><span class="line">        inflate();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 追加字符</span></span><br><span class="line">    asb.getBytes(value, count, coder);</span><br><span class="line">    <span class="comment">// 修改已使用字符数</span></span><br><span class="line">    count += len;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> AbstractStringBuilder <span class="title function_">appendNull</span><span class="params">()</span> &#123;</span><br><span class="line">    ensureCapacityInternal(count + <span class="number">4</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.count;</span><br><span class="line">    <span class="type">byte</span>[] val = <span class="built_in">this</span>.value;</span><br><span class="line">    <span class="keyword">if</span> (isLatin1()) &#123;</span><br><span class="line">        val[count++] = <span class="string">&#x27;n&#x27;</span>;</span><br><span class="line">        val[count++] = <span class="string">&#x27;u&#x27;</span>;</span><br><span class="line">        val[count++] = <span class="string">&#x27;l&#x27;</span>;</span><br><span class="line">        val[count++] = <span class="string">&#x27;l&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        count = StringUTF16.putCharsAt(val, count, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;l&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.count = count;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">getBytes</span><span class="params">(<span class="type">byte</span> dst[], <span class="type">int</span> dstBegin, <span class="type">byte</span> coder)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.coder == coder) &#123;</span><br><span class="line">        System.arraycopy(value, <span class="number">0</span>, dst, dstBegin &lt;&lt; coder, count &lt;&lt; coder);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;        <span class="comment">// this.coder == LATIN &amp;&amp; coder == UTF16</span></span><br><span class="line">        StringLatin1.inflate(value, <span class="number">0</span>, dst, dstBegin, count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>append</code>追加<code>CharSequence</code>对象时，如果对象为<code>null</code>则追加”null”四个字符，如果对象是<code>String</code>类的实例则调用其重载方法append(String str)，如果对象是<code>AbstractStringBuilder</code>类的实例则调用其重载方法append(AbstractStringBuilder asb)，否则调用重载方法<code>append(CharSequence s, int start, int end)</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Documentation in subclasses because of synchro difference</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">append</span><span class="params">(CharSequence s)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> appendNull();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (s <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.append((String)s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (s <span class="keyword">instanceof</span> AbstractStringBuilder) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.append((AbstractStringBuilder)s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.append(s, <span class="number">0</span>, s.length());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../../../../../../imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911191912514.png" alt="image-20230911191912514"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">append</span><span class="params">(CharSequence s, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="literal">null</span>) &#123;</span><br><span class="line">        s = <span class="string">&quot;null&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    checkRange(start, end, s.length());</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> end - start;</span><br><span class="line">    ensureCapacityInternal(count + len);</span><br><span class="line">    appendChars(s, start, end);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">appendChars</span><span class="params">(CharSequence s, <span class="type">int</span> off, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isLatin1()) &#123;</span><br><span class="line">        <span class="type">byte</span>[] val = <span class="built_in">this</span>.value;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> off, j = count; i &lt; end; i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(i);</span><br><span class="line">            <span class="comment">// 待添加的字符位于Lantin1范围，可以直接追加</span></span><br><span class="line">            <span class="keyword">if</span> (StringLatin1.canEncode(c)) &#123;</span><br><span class="line">                val[j++] = (<span class="type">byte</span>)c;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// j表示当前的字符序列的长度</span></span><br><span class="line">                count = j;</span><br><span class="line">                <span class="comment">// 超出Latin1范围的话需要先把Latin1编码的字符序列转化为UTF16编码</span></span><br><span class="line">                inflate();</span><br><span class="line">                <span class="comment">// 在字符索引j处继续追加剩余的字符[i,end)</span></span><br><span class="line">                StringUTF16.putCharsSB(<span class="built_in">this</span>.value, j, s, i, end);</span><br><span class="line">                <span class="comment">// 修改有效字符数</span></span><br><span class="line">                count += end - i;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        StringUTF16.putCharsSB(<span class="built_in">this</span>.value, count, s, off, end);</span><br><span class="line">    &#125;</span><br><span class="line">    count += end - off;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>append</code>追加基本数据类型的几个重载函数如下，仅仅是举了几个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">append</span><span class="params">(<span class="type">boolean</span> b)</span> &#123;</span><br><span class="line">    ensureCapacityInternal(count + (b ? <span class="number">4</span> : <span class="number">5</span>));</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.count;</span><br><span class="line">    <span class="type">byte</span>[] val = <span class="built_in">this</span>.value;</span><br><span class="line">    <span class="keyword">if</span> (isLatin1()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b) &#123;</span><br><span class="line">            val[count++] = <span class="string">&#x27;t&#x27;</span>;</span><br><span class="line">            val[count++] = <span class="string">&#x27;r&#x27;</span>;</span><br><span class="line">            val[count++] = <span class="string">&#x27;u&#x27;</span>;</span><br><span class="line">            val[count++] = <span class="string">&#x27;e&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            val[count++] = <span class="string">&#x27;f&#x27;</span>;</span><br><span class="line">            val[count++] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            val[count++] = <span class="string">&#x27;l&#x27;</span>;</span><br><span class="line">            val[count++] = <span class="string">&#x27;s&#x27;</span>;</span><br><span class="line">            val[count++] = <span class="string">&#x27;e&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (b) &#123;</span><br><span class="line">            count = StringUTF16.putCharsAt(val, count, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;e&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            count = StringUTF16.putCharsAt(val, count, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;e&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.count = count;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">append</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">    ensureCapacityInternal(count + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (isLatin1() &amp;&amp; StringLatin1.canEncode(c)) &#123;</span><br><span class="line">        value[count++] = (<span class="type">byte</span>)c;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isLatin1()) &#123;</span><br><span class="line">            inflate();</span><br><span class="line">        &#125;</span><br><span class="line">        StringUTF16.putCharSB(value, count++, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">append</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.count;</span><br><span class="line">    <span class="type">int</span> <span class="variable">spaceNeeded</span> <span class="operator">=</span> count + Integer.stringSize(i);</span><br><span class="line">    ensureCapacityInternal(spaceNeeded);</span><br><span class="line">    <span class="keyword">if</span> (isLatin1()) &#123;</span><br><span class="line">        Integer.getChars(i, spaceNeeded, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        StringUTF16.getChars(i, count, spaceNeeded, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.count = spaceNeeded;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、AbstractStringBuilder类的删除方法"><a href="#七、AbstractStringBuilder类的删除方法" class="headerlink" title="七、AbstractStringBuilder类的删除方法"></a>七、AbstractStringBuilder类的删除方法</h2><p><code>delete</code>操作用于删除字符序列的某一部分，详细解释见源代码注释：</p>
<p><img src="/../../../../../../imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911194021699.png" alt="image-20230911194021699"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">delete</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.count;</span><br><span class="line">    	<span class="comment">// end最多是字符序列的长度count</span></span><br><span class="line">        <span class="keyword">if</span> (end &gt; count) &#123;</span><br><span class="line">            end = count;</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">// 检查参数有效性</span></span><br><span class="line">        checkRangeSIOOBE(start, end, count);</span><br><span class="line">    	<span class="comment">// 待删除的字符数量</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> end - start;</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 删除字符序列的某一部分</span></span><br><span class="line">            shift(end, -len);</span><br><span class="line">            <span class="comment">// 减少字符序列的长度</span></span><br><span class="line">            <span class="built_in">this</span>.count = count - len;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">checkRangeSIOOBE</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end, <span class="type">int</span> len)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (start &lt; <span class="number">0</span> || start &gt; end || end &gt; len) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StringIndexOutOfBoundsException</span>(</span><br><span class="line">                <span class="string">&quot;start &quot;</span> + start + <span class="string">&quot;, end &quot;</span> + end + <span class="string">&quot;, length &quot;</span> + len);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  注意：这里的n是负数，因此下面的代码含义是把删除序列后面的子字符序列前移拼接</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">shift</span><span class="params">(<span class="type">int</span> offset, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        System.arraycopy(value, offset &lt;&lt; coder,</span><br><span class="line">                         value, (offset + n) &lt;&lt; coder, (count - offset) &lt;&lt; coder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">arraycopy</span><span class="params">(Object src,  <span class="type">int</span>  srcPos,</span></span><br><span class="line"><span class="params">                                        Object dest, <span class="type">int</span> destPos,</span></span><br><span class="line"><span class="params">                                        <span class="type">int</span> length)</span>;</span><br></pre></td></tr></table></figure>

<p><code>deleteCharAt</code>方法删除此序列中指定位置的字符，此序列缩短了一个字符。如果给定索引处的字符是增补字符，则此方法不会删除整个字符。如果需要正确处理增补字符，请通过调用Character.charCount(thisSequence.codePointAt(index))来确定要删除的字符数，其中thisSequence是此序列。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">deleteCharAt</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    checkIndex(index, count);</span><br><span class="line">    shift(index + <span class="number">1</span>, -<span class="number">1</span>);</span><br><span class="line">    count--;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、AbstractStringBuilder类的修改方法"><a href="#八、AbstractStringBuilder类的修改方法" class="headerlink" title="八、AbstractStringBuilder类的修改方法"></a>八、AbstractStringBuilder类的修改方法</h2><p><code>ensureCapacity</code>方法确保容量至少等于指定的最小值。如果当前容量小于参数值，则会分配具有更大容量的新内部数组。新容量是以下容量中较大的一个：<code>minimumCapacity参数</code>和<code>原来的capacity参数*2+2</code>。如果minimumCapacity参数为非正数，则此方法不执行任何操作仅返回。请注意，对此对象的后续操作可能会使实际容量低于此处请求的容量。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ensureCapacity</span><span class="params">(<span class="type">int</span> minimumCapacity)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (minimumCapacity &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            ensureCapacityInternal(minimumCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>ensureCapacityInternal</code>方法的行为与ensureCapacity类似，不过不保证线程同步。如果minimumCapacity参数小于当前容量，则不做任何改动。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureCapacityInternal</span><span class="params">(<span class="type">int</span> minimumCapacity)</span> &#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> value.length &gt;&gt; coder;</span><br><span class="line">    <span class="keyword">if</span> (minimumCapacity - oldCapacity &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        value = Arrays.copyOf(value,</span><br><span class="line">                              newCapacity(minimumCapacity) &lt;&lt; coder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>newCapacity</code>返回至少与给定minCapacity参数值一样大的容量。返回原容量*2+2（如果足够）。不会返回大于<code>MAX_ARRAY_SIZE&gt;&gt;coder</code>（绝对安全容量界限）的容量，除非给定的minCapacity参数值大于该容量（即使如此，也不会返回大于<code>Integer.MAX_VALUE&gt;&gt;coder</code>的容量）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">newCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="comment">// 当前容量</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> value.length &gt;&gt; coder;</span><br><span class="line">    <span class="comment">// 计算新容量=当前容量*2+2</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> (oldCapacity &lt;&lt; <span class="number">1</span>) + <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 计算新容量=max(当前容量*2+2,minCapacity)</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 绝对安全容量界限</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">SAFE_BOUND</span> <span class="operator">=</span> MAX_ARRAY_SIZE &gt;&gt; coder;</span><br><span class="line">    <span class="comment">// 未到达SAFE_BOUND之前直接使用计算的新容量，否则使用hugeCapacity重新计算修正</span></span><br><span class="line">    <span class="keyword">return</span> (newCapacity &lt;= <span class="number">0</span> || SAFE_BOUND - newCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        ? hugeCapacity(minCapacity)</span><br><span class="line">        : newCapacity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">hugeCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="comment">// 绝对安全容量界限</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">SAFE_BOUND</span> <span class="operator">=</span> MAX_ARRAY_SIZE &gt;&gt; coder;</span><br><span class="line">    <span class="comment">// 不安全容量界限,已经是极限了</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">UNSAFE_BOUND</span> <span class="operator">=</span> Integer.MAX_VALUE &gt;&gt; coder;</span><br><span class="line">    <span class="comment">// 请求的minCapacity参数值过大，甚至超出了UNSAFE_BOUND，数组下标用整数类型都无法覆盖</span></span><br><span class="line">    <span class="keyword">if</span> (UNSAFE_BOUND - minCapacity &lt; <span class="number">0</span>) &#123; <span class="comment">// overflow</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OutOfMemoryError</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回的容量范围位于[SAFE_BOUND,UNSAFE_BOUND]</span></span><br><span class="line">    <span class="keyword">return</span> (minCapacity &gt; SAFE_BOUND)</span><br><span class="line">        ? minCapacity : SAFE_BOUND;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>inflate</code>方法把原来由<code>LATIN1</code>编码的value数组扩展为<code>UTF16</code>编码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">inflate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isLatin1()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">byte</span>[] buf = StringUTF16.newBytesFor(value.length);</span><br><span class="line">    StringLatin1.inflate(value, <span class="number">0</span>, buf, <span class="number">0</span>, count);</span><br><span class="line">    <span class="built_in">this</span>.value = buf;</span><br><span class="line">    <span class="built_in">this</span>.coder = UTF16;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StringLatin1.inflate</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">inflate</span><span class="params">(<span class="type">byte</span>[] src, <span class="type">int</span> srcOff, <span class="type">byte</span>[] dst, <span class="type">int</span> dstOff, <span class="type">int</span> len)</span> &#123;</span><br><span class="line">    StringUTF16.inflate(src, srcOff, dst, dstOff, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StringUTF16.inflate</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">inflate</span><span class="params">(<span class="type">byte</span>[] src, <span class="type">int</span> srcOff, <span class="type">byte</span>[] dst, <span class="type">int</span> dstOff, <span class="type">int</span> len)</span> &#123;</span><br><span class="line">    <span class="comment">// We need a range check here because &#x27;putChar&#x27; has no checks</span></span><br><span class="line">    checkBoundsOffCount(dstOff, len, dst);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        putChar(dst, dstOff++, src[srcOff++] &amp; <span class="number">0xff</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>trimToSize</code>方法尝试减少用于存储字符序列的空间。如果缓冲区大于保存当前字符序列所需的空间，则可以调整其大小以提高空间效率。调用此方法可能会影响后续调用capacity方法的返回值，但不是必需的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">trimToSize</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> count &lt;&lt; coder;</span><br><span class="line">    <span class="keyword">if</span> (length &lt; value.length) &#123;</span><br><span class="line">        value = Arrays.copyOf(value, length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>setLength</code>方法设置AbstractStringBuilder的长度即<code>count</code>，根据<code>newLength</code>参数的大小进行<code>value</code>数组的<code>补空字符</code>或<code>截断</code>操作。具体源代码注释如下：</p>
<p><img src="/../../../../../../imgs/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/image-20230911163713755.png" alt="image-20230911163713755"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLength</span><span class="params">(<span class="type">int</span> newLength)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (newLength &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StringIndexOutOfBoundsException</span>(newLength);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 首先需要保证容量足够即不低于newLength</span></span><br><span class="line">    ensureCapacityInternal(newLength);</span><br><span class="line">    <span class="comment">// 如果newLength大于当前容量，多余的填充空字符(LANTIN1==&gt;&#x27;\u00&#x27;或UTF16==&gt;&#x27;\u0000&#x27;)</span></span><br><span class="line">    <span class="keyword">if</span> (count &lt; newLength) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isLatin1()) &#123;</span><br><span class="line">            StringLatin1.fillNull(value, count, newLength);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            StringUTF16.fillNull(value, count, newLength);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置当前长度，如果newLength小于或等于当前容量，多余的直接截断</span></span><br><span class="line">    count = newLength;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StringLatin1.fillNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">fillNull</span><span class="params">(<span class="type">byte</span>[] val, <span class="type">int</span> index, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">    Arrays.fill(val, index, end, (<span class="type">byte</span>)<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StringUTF16.fillNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">fillNull</span><span class="params">(<span class="type">byte</span>[] val, <span class="type">int</span> index, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">    Arrays.fill(val, index &lt;&lt; <span class="number">1</span>, end &lt;&lt; <span class="number">1</span>, (<span class="type">byte</span>)<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">fill</span><span class="params">(<span class="type">byte</span>[] a, <span class="type">int</span> fromIndex, <span class="type">int</span> toIndex, <span class="type">byte</span> val)</span> &#123;</span><br><span class="line">    rangeCheck(a.length, fromIndex, toIndex);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> fromIndex; i &lt; toIndex; i++)</span><br><span class="line">        a[i] = val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>setCharAt</code>方法指定index索引处的字符设置为ch，当然需要考虑字符编码的问题，具体见代码注释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCharAt</span><span class="params">(<span class="type">int</span> index, <span class="type">char</span> ch)</span> &#123;</span><br><span class="line">    checkIndex(index, count);</span><br><span class="line">    <span class="comment">// 该类采用Latin1编码方式，并且待设置的字符位于Latin1表示范围内</span></span><br><span class="line">    <span class="keyword">if</span> (isLatin1() &amp;&amp; StringLatin1.canEncode(ch)) &#123;</span><br><span class="line">        value[index] = (<span class="type">byte</span>)ch;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 该类采用Latin1编码方式，但是因为待设置的字符超出Latin1表示范围，因此需要扩展为UTF16编码方式</span></span><br><span class="line">        <span class="keyword">if</span> (isLatin1()) &#123;</span><br><span class="line">            inflate();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 设置指定索引处的字符码元</span></span><br><span class="line">        StringUTF16.putCharSB(value, index, ch);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Lantin1表示的范围是[0x00,0xFF]</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">canEncode</span><span class="params">(<span class="type">int</span> cp)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cp &gt;&gt;&gt; <span class="number">8</span> == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">putCharSB</span><span class="params">(<span class="type">byte</span>[] val, <span class="type">int</span> index, <span class="type">int</span> c)</span> &#123;</span><br><span class="line">    checkIndex(index, val);</span><br><span class="line">    putChar(val, index, c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">putChar</span><span class="params">(<span class="type">byte</span>[] val, <span class="type">int</span> index, <span class="type">int</span> c)</span> &#123;</span><br><span class="line">    <span class="keyword">assert</span> index &gt;= <span class="number">0</span> &amp;&amp; index &lt; length(val) : <span class="string">&quot;Trusted caller missed bounds check&quot;</span>;</span><br><span class="line">    index &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    val[index++] = (<span class="type">byte</span>)(c &gt;&gt; HI_BYTE_SHIFT);</span><br><span class="line">    val[index]   = (<span class="type">byte</span>)(c &gt;&gt; LO_BYTE_SHIFT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>replace</code>方法用于替换给定区间[start,end)字符序列为目标字符串str表示的字符序列</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AbstractStringBuilder <span class="title function_">replace</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end, String str)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.count;</span><br><span class="line">    <span class="keyword">if</span> (end &gt; count) &#123;</span><br><span class="line">        end = count;</span><br><span class="line">    &#125;</span><br><span class="line">    checkRangeSIOOBE(start, end, count);</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> str.length();</span><br><span class="line">    <span class="type">int</span> <span class="variable">newCount</span> <span class="operator">=</span> count + len - (end - start);</span><br><span class="line">    ensureCapacityInternal(newCount);</span><br><span class="line">    <span class="comment">// 这一步是关键（把删除区间后的子序列[end,count)移动到正确的位置[start+len,newCount)，给str腾出空间），newCount-count其实就是len-(end-start)</span></span><br><span class="line">    shift(end, newCount - count);</span><br><span class="line">    <span class="built_in">this</span>.count = newCount;</span><br><span class="line">    <span class="comment">// 填充目标字符串，填充区间是[start,start+len)</span></span><br><span class="line">    putStringAt(start, str);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">putStringAt</span><span class="params">(<span class="type">int</span> index, String str)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (getCoder() != str.coder()) &#123;</span><br><span class="line">        inflate();</span><br><span class="line">    &#125;</span><br><span class="line">    str.getBytes(value, index, coder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/hulingF">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">AbstractStringBuilder类源码剖析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">一、AbstractStringBuilder类的简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="toc-number">1.2.</span> <span class="toc-text">二、AbstractStringBuilder类的字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">三、AbstractStringBuilder类的构造方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E4%B8%80%E4%BA%9B%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.</span> <span class="toc-text">四、AbstractStringBuilder类的一些方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E6%9F%A5%E6%89%BE%E6%96%B9%E6%B3%95"><span class="toc-number">1.5.</span> <span class="toc-text">五、AbstractStringBuilder类的查找方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E6%B7%BB%E5%8A%A0%E6%96%B9%E6%B3%95"><span class="toc-number">1.6.</span> <span class="toc-text">六、AbstractStringBuilder类的添加方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E5%88%A0%E9%99%A4%E6%96%B9%E6%B3%95"><span class="toc-number">1.7.</span> <span class="toc-text">七、AbstractStringBuilder类的删除方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81AbstractStringBuilder%E7%B1%BB%E7%9A%84%E4%BF%AE%E6%94%B9%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.</span> <span class="toc-text">八、AbstractStringBuilder类的修改方法</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&text=AbstractStringBuilder类源码剖析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&title=AbstractStringBuilder类源码剖析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&is_video=false&description=AbstractStringBuilder类源码剖析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=AbstractStringBuilder类源码剖析&body=Check out this article: https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&title=AbstractStringBuilder类源码剖析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&title=AbstractStringBuilder类源码剖析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&title=AbstractStringBuilder类源码剖析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&title=AbstractStringBuilder类源码剖析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&name=AbstractStringBuilder类源码剖析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://hulingf.github.io/2023/09/09/AbstractStringBuilder%E7%B1%BB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/&t=AbstractStringBuilder类源码剖析"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    hulingF
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/hulingF">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'hulingF';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
